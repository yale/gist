/*
HTTP Host: static.ak.fbcdn.net
Generated: October 5th 2010 9:03:42 AM PDT
Machine: 10.30.146.199
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/2dm7thlclh7ow4cc.pkg.js\"]); }\n\nvar ExternalNodeConnectWidget=function(f){copy_properties(this,{widgetID:f.widgetID,widget:$(f.widgetID),viewerID:f.viewer,nodeType:f.nodeType,viewerIsAdmin:f.viewerIsAdmin&&!f.userOptedOut,adminUrl:f.adminUrl,popupOptInUri:new URI('\/connect\/uiserver.php'),nodeUri:new URI(f.nodeURL),externalUrl:f.externalURL,pageId:f.pageId,layout:f.layout,edgeType:f.edgeType,error:f.error,errorURI:new URI('\/home.php'),alreadyConnected:f.alreadyConnected,usingConnectLibrary:!!f.channelURL,commentWidgetMarkup:f.commentWidgetMarkup,commentWidgetOpen:false,commentWidgetVisible:false,commentWidgetExpanded:true,userProfile:null,connectStoryFbid:0,isAmbiguousText:f.isAmbiguousText,socialBar:f.socialbar,useDisconnectLink:f.useDisconnectLink,showError:f.showError,showFaces:f.showFaces,connectText:f.connectText,ref:f.ref,userOptedOut:f.userOptedOut,usingInlineCommenting:f.usingInlineCommenting,supportCommenting:!!f.channelURL||f.usingInlineCommenting,inlineCommentListenersInitialized:false,isBlocked:f.isBlocked});if(this.usingConnectLibrary)UnverifiedXD.init({autoResize:f.autoResize,channelUrl:f.channelURL,resizeWidth:f.autoResize&&f.layout!==ExternalNodeConnectWidget.STANDARD_LAYOUT});this.subscribeToSync(f);this.connectButtonSlider=DOM.find(this.widget,'div.connect_button_slider');this.connectButtonContainer=DOM.find(this.connectButtonSlider,'div.connect_button_container');this.connectButton=DOM.find(this.widget,'a.connect_widget_like_button');this.connectedMessage=DOM.find(this.widget,'span.connect_widget_connected_text');this.notConnectedMessage=DOM.find(this.widget,'span.connect_widget_not_connected_text');this.adminSpans=DOM.scry(this.widget,'span.connect_widget_admin_span');if(this.adminSpans.length>0){this.adminLinks=[];for(var a=0;a<this.adminSpans.length;a++)this.adminLinks[a]=DOM.find(this.adminSpans[a],'a.connect_widget_admin_option');}if(this.layout==ExternalNodeConnectWidget.STANDARD_LAYOUT){this.confirmationCell=DOM.find(this.widget,'div.connect_confirmation_cell');this.userActionTextSpan=DOM.find(this.confirmationCell,'span.connect_widget_user_action');this.summaryTextSpan=DOM.find(this.confirmationCell,'span.connect_widget_summary');if(f.showFaces&&f.viewer>0)this.loggedInUserPhotoDiv=DOM.find(this.widget,'div.connect_widget_logged_in_user');}this.setQueryData();if(this.pageId)this.popupOptInUri.addQueryData({connect_id:this.pageId});this.errorSpans=DOM.scry(this.widget,'span.connect_widget_error_span');if(this.errorSpans.length>0){this.errorLinks=[];for(var b=0;b<this.errorSpans.length;b++)this.errorLinks[b]=DOM.find(this.errorSpans[b],'a.connect_widget_error_text');}this.unlikeSpans=DOM.scry(this.widget,'span.unlike_span');this.unlikeLinks=[];for(var c=0;c<this.unlikeSpans.length;c++){this.unlikeLinks[c]=DOM.find(this.unlikeSpans[c],'a.connect_widget_unlike_link');Event.listen(this.unlikeLinks[c],'click',this.connectToNodeOnClick.bind(this));}var e=DOM.scry(this.widget,'div.connect_widget_number_cloud');if(e.length==1){this.numberCloud=e[0];this.numberCloudNub=DOM.find(this.widget,'div.connect_widget_number_cloud_nub');this.numberCloudExtension=DOM.find(this.numberCloud,'div.connect_widget_number_cloud_extension');this.sizeNumberCloud();this.numberCloudUnlikeSpan=DOM.find(this.numberCloudExtension,'span.unlike_span');this.numberCloudReminderSpan=DOM.find(this.numberCloudExtension,'span.like_reminder');this.inAnimation=false;this.reminderIsVisible=CSS.hasClass(this.numberCloudUnlikeSpan,'hidden_elem');Event.listen(this.numberCloud,'mouseleave',this.restoreReminderSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseleave',this.restoreReminderSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseenter',this.exposeUnlikeSpan.bind(this));Event.listen(this.numberCloud,'mouseenter',this.exposeUnlikeSpan.bind(this));Event.listen(this.numberCloudExtension,'mouseleave',function(event){this.requiresMouseLeaveEvent=false;}.bind(this));}if(this.usingInlineCommenting&&!this.showFaces){this.shareCommentSpans=DOM.scry(this.widget,'span.connect_widget_share_comment_span');for(var d=0;d<this.shareCommentSpans.length;d++){var g=DOM.find(this.shareCommentSpans[d],'a.connect_widget_share_comment_option');Event.listen(g,'click',function(event){for(var h=0;h<this.shareCommentSpans.length;h++)CSS.addClass(this.shareCommentSpans[h],'hidden_elem');this.presentCommentingOption();}.bind(this));}}if(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){XD.forced_min_width=this.getButtonCountWidgetWidth();this.numberExcluding=DOM.find(this.widget,'td.connect_widget_button_count_excluding');this.summaryIncluding=DOM.find(this.widget,'td.connect_widget_button_count_including');this.thumbsUpIcon=DOM.find(this.summaryIncluding,'div.thumbs_up');this.undoRegion=DOM.find(this.summaryIncluding,'div.undo');this.undoButton=DOM.find(this.undoRegion,'label.undo_button input');this.originalButtonWidth=this.computeButtonDimensions().width;Event.listen(this.undoButton,'click',this.connectToNodeOnClick.bind(this));Event.listen(this.thumbsUpIcon,'mouseenter',function(event){CSS.addClass(this.thumbsUpIcon,'hidden_elem');CSS.removeClass(this.undoRegion,'hidden_elem');}.bind(this));Event.listen(this.undoRegion,'mouseleave',function(event){CSS.removeClass(this.thumbsUpIcon,'hidden_elem');CSS.addClass(this.undoRegion,'hidden_elem');}.bind(this));}this.confirmationText&&!this.isAmbiguousText&&!this.usingConnectLibrary;if(!this.isBlocked)Event.listen(this.connectButton,'click',this.connectToNodeOnClick.bind(this));Bootloader.loadComponents('mouse-extent-element',bind(this,function(){if(window.MouseExtentElement){this.mouseExtent=new MouseExtentElement(this.connectButton);this.loadTime=new Date().getTime();}}));if(this.adminLinks)for(var a=0;a<this.adminLinks.length;a++)Event.listen(this.adminLinks[a],'click',this.presentAdminPage.bind(this));if(this.errorLinks)for(var a=0;a<this.errorLinks.length;a++)Event.listen(this.errorLinks[a],'click',this.presentErrorDialog.bind(this));if(f.showCaptcha){this.showCaptcha=true;this.connectToNode(true);}};copy_properties(ExternalNodeConnectWidget,{STANDARD_LAYOUT:'standard',BOX_COUNT_LAYOUT:'box_count',BUTTON_COUNT_LAYOUT:'button_count',OPT_IN_FACEBOOK_APP_ID:'127760087237610',updateLoggedInUser:function(b){var a=ExternalNodeConnectWidget.controllerManagingLogin;a.setLoggedIn(b);a.connectToNode(true);a.userOptedOut=false;delete ExternalNodeConnectWidget.controllerManagingLogin;Arbiter.inform('platform\/socialplugins\/login',{user:b.user},Arbiter.BEHAVIOR_STATE);WidgetArbiter.inform('platform\/socialplugins\/login',{user:b.user},Arbiter.BEHAVIOR_STATE);},onCommentWidgetLoaded:function(a){var b=ExternalNodeConnectWidget.self;delete ExternalNodeConnectWidget.self;b.injectCommentWidgetMarkup(a);}});copy_properties(ExternalNodeConnectWidget.prototype,{getSyncEndpointName:function(){},getConnectionEndpointName:function(){},getPluginName:function(){},subscribeToSync:function(a){Arbiter.subscribe('platform\/socialplugins\/login',function(c,b){if(this.viewerID&&b.user!==this.viewerID)document.location.reload();}.bind(this));Arbiter.subscribe(this.getSyncEndpointName(),function(c,b){if(b.externalUrl==a.externalURL){this.userOptedOut=false;this.updateWidget(b.opts,true);}}.bind(this));},setQueryData:function(){this.popupOptInUri.addQueryData({social_plugin:this.getPluginName(),external_page_url:this.externalUrl,method:'opt.inlike',display:'popup',app_id:ExternalNodeConnectWidget.OPT_IN_FACEBOOK_APP_ID});},updateWidget:function(c,b){var a=(this.alreadyConnected!=c.nowConnected);Arbiter.inform(this.getConnectionEndpointName(),c,Arbiter.BEHAVIOR_STATE);this.alreadyConnected=c.nowConnected;this.viewerIsAdmin=c.isAdmin;this.showError=c.showError;this.adminUrl=c.adminUrl;this.userProfile=c.userProfile;this.connectStoryFbid=c.connectStoryFbid;this.error=c.error;if(!c.nowConnected)this.closeCommentWidget();if(a||this.error)this.syncWidgetDisplay();if(!b)WidgetArbiter.inform(this.getSyncEndpointName(),{externalUrl:this.externalUrl,opts:c},Arbiter.BEHAVIOR_STATE);},presentOptIn:function(){var b='_blank';var a='location=1, toolbar=0, status=0, width=450, height=420';ExternalNodeConnectWidget.controllerManagingLogin=this;window.open(this.popupOptInUri.toString(),b,a);},setLoggedIn:function(a){this.viewerID=a.user;this.newProfilePic=a.profilePic;this.placeFormUserCheck(a.formUserCheck,a.fbDtsg);},placeFormUserCheck:function(b,a){window.Env.fb_dtsg=a;if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(b));}else DOM.appendContent(DOM.find(document,'body'),HTML(b));},syncWidgetWithServer:function(c){var b=c.getPayload();if(b.requires_login){this.updateWidget({nowConnected:false,isAdmin:false},false);this.presentOptIn();return;}var a={nowConnected:b.success&&b.already_connected,isAdmin:b.is_admin,showError:b.show_error,adminUrl:b.admin_url,userProfile:b.user_profile,connectStoryFbid:b.story_fbid,error:b.error_info};this.updateWidget(a,false);if(b.success&&this.showCaptcha){window.opener.location.reload();window.close();}},getButtonCountWidgetWidth:function(){var a=DOM.find(this.widget,'table.connect_widget_interactive_area');var b=CSS.getStyle(a,'width');return parseInt(b,10);},sizeNumberCloud:function(){this.collapsedNumberCloudHeight=this.getCollapsedNumberCloudHeight();this.expandedNumberCloudHeight=this.collapsedNumberCloudHeight+this.getNumberCloudExtensionHeight();if(this.alreadyConnected)CSS.setStyle(this.numberCloud,'height',this.expandedNumberCloudHeight+'px');Bootloader.loadComponents(['vector'],bind(this,function(){var a=this.computeButtonDimensionsWithPadding().width;XD.forced_min_width=a;var b=intl_locale_is_rtl();a-=2;CSS.setStyle(this.numberCloud,'width',a+'px');CSS.setStyle(this.numberCloud,'visibility','visible');animation(this.numberCloud).from('opacity',0).to('opacity',1).duration(100).go();}));},getCollapsedNumberCloudHeight:function(){var b=Vector2.getElementDimensions(this.numberCloud).y;var d=parseInt(CSS.getStyle(this.numberCloud,'paddingTop'),10);var c=parseInt(CSS.getStyle(this.numberCloud,'paddingBottom'),10);var a=parseInt(CSS.getStyle(this.numberCloud,'border'),10);return b-d-c-2;},getNumberCloudExtensionHeight:function(){CSS.addClass(this.numberCloudExtension,'connect_widget_offscreen');if(!this.alreadyConnected)CSS.removeClass(this.numberCloudExtension,'hidden_elem');var a=Vector2.getElementDimensions(this.numberCloudExtension).y;if(!this.alreadyConnected)CSS.addClass(this.numberCloudExtension,'hidden_elem');CSS.removeClass(this.numberCloudExtension,'connect_widget_offscreen');return a;},restoreReminderSpan:function(event){if(this.reminderIsVisible||this.inAnimation)return;this.animateReminderSpanReappearance();},animateReminderSpanReappearance:function(){if(this.reminderIsVisible||this.inAnimation)return;this.inAnimation=true;CSS.addClass(this.numberCloudUnlikeSpan,'hidden_elem');CSS.setStyle(this.numberCloudReminderSpan,'opacity',0);CSS.removeClass(this.numberCloudReminderSpan,'hidden_elem');animation(this.numberCloudReminderSpan).to('opacity',1).duration(100).ondone(function(){this.inAnimation=false;this.reminderIsVisible=true;}.bind(this)).go();},exposeUnlikeSpan:function(event){if(!this.alreadyConnected||this.requiresMouseLeaveEvent||!this.reminderIsVisible||this.inAnimation)return;this.inAnimation=true;CSS.addClass(this.numberCloudReminderSpan,'hidden_elem');CSS.setStyle(this.numberCloudUnlikeSpan,'opacity',0);CSS.removeClass(this.numberCloudUnlikeSpan,'hidden_elem');animation(this.numberCloudUnlikeSpan).to('opacity',1).duration(100).ondone(function(){this.inAnimation=false;this.reminderIsVisible=false;}.bind(this)).go();},conditionallyActivateButton:function(event){this.commentButtonIsActive=this.inlineCommentInput.value.trim().length>0;},updateConnectionWithComment:function(event){Event.kill(event);if(this.commentButtonIsActive){this.postInlineComment();this.resetInlineComment();this.closeInlineComment();}},postInlineComment:function(){this.postUserComment(this.inlineCommentInput.value.trim());},resetInlineComment:function(){this.concealCommentButton();var a=this.inlineCommentInput.getAttribute('placeholder');this.inlineCommentInput.value=a;},showInlineComment:function(event){Event.kill(event);if(!this.inlineCommentFlyoutOpen||this.inlineCommentFlyoutVisible)return;this.inlineCommentFlyoutVisible=true;CSS.show(this.inlineCommentFlyout);},hideInlineComment:function(event){Event.kill(event);if(!this.inlineCommentFlyoutOpen||!this.inlineCommentFlyoutVisible)return;var b=this.inlineCommentInput.value.trim();var a=this.inlineCommentInput.getAttribute('placeholder');if(b.length>0&&b!=a)return;this.inlineCommentFlyoutVisible=false;CSS.hide(this.inlineCommentFlyout);},closeInlineComment:function(){this.inlineCommentFlyoutVisible=false;this.inlineCommentFlyoutOpen=false;CSS.hide(this.inlineCommentFlyout);this.resetInlineComment();},concealCommentButton:function(){CSS.addClass(this.inlineCommentButton,'hidden_elem');CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithoutButton+'px');},positionInlineCommentFlyout:function(){CSS.addClass(this.inlineCommentFlyout,'comment_widget_offscreen');CSS.removeClass(this.inlineCommentFlyout,'hidden_elem');var b=0;var a=this.computeButtonDimensions();var e=a.height;var d=b+20;var g=intl_locale_is_rtl()?'right':'left';if(this.showFaces){var k=DOM.scry(this.widget,'span.connect_widget_text')[0];var h=intl_locale_is_rtl()?'paddingRight':'paddingLeft';var l=CSS.getStyle(k,h);d=b+parseInt(l,10);var i=DOM.find(this.widget,'div.connect_widget_sample_connections');var j=Vector2.getElementDimensions(i).y;e=j-3;}CSS.setStyle(this.inlineCommentFlyout,g,d+'px');CSS.setStyle(this.inlineCommentFlyout,'top',(-e)+'px');var n=Vector2.getElementPosition(this.widget,'document').x;var m=Vector2.getElementDimensions(this.widget).x;var o=n+m-d-5;CSS.setStyle(this.inlineCommentFlyout,'width',o+'px');CSS.removeClass(this.inlineCommentButton,'hidden_elem');var f=Vector2.getElementDimensions(this.inlineCommentButton).x;CSS.addClass(this.inlineCommentButton,'hidden_elem');var c=(this.inlineCommentClose)?15:0;this.textInputWidthWithoutButton=o-24-c;this.textInputWidthWithButton=this.textInputWidthWithoutButton-f-1;CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithoutButton+'px');CSS.removeClass(this.inlineCommentFlyout,'comment_widget_offscreen');CSS.addClass(this.inlineCommentFlyout,'hidden_elem');},postUserComment:function(a){var b={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,page_id:this.pageId,connect_text:this.connectText,story_fbid:this.connectStoryFbid,comment:a};Bootloader.loadComponents(['async','async-postlude'],function(){new AsyncRequest().setURI(this.getCommentAjaxEndpoint()).setData(b).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();}.bind(this));this.closeCommentWidget();},closeCommentWidget:function(){if(this.commentWidgetOpen){delete this.inGracePeriod;delete this.commentWidgetIsExpanded;this.commentWidgetVisible=false;this.commentWidgetOpen=false;UnverifiedXD.send({type:'dismissEdgeCommentDialog'});}},presentAdminPage:function(){var a='_blank';window.open(this.adminUrl.toString(),a);},presentErrorDialog:function(){var c='_blank';var b='toolbar=0, status=0, width=960, height=300';var a=new URI('\/connect\/connect_to_node_error.php');a.addQueryData({title:this.error.brief,body:this.error.full});window.open(a.toString(),c,b);},syncWidgetDisplay:function(){var a=this.alreadyConnected;this.setButtonState(a);this.showElementIf(this.connectedMessage,a);this.showElementIf(this.notConnectedMessage,!a);for(var b=0;b<this.adminSpans.length;b++)this.showElementIf(this.adminSpans[b],this.viewerIsAdmin);for(var c=0;c<this.errorSpans.length;c++)this.showElementIf(this.errorSpans[c],this.error&&(this.viewerIsAdmin||this.showError));for(var d=0;d<this.unlikeSpans.length;d++)this.showElementIf(this.unlikeSpans[d],this.alreadyConnected);if(this.shareCommentSpans)for(var e=0;e<this.shareCommentSpans.length;e++)this.showElementIf(this.shareCommentSpans[e],a);if(this.layout!==ExternalNodeConnectWidget.BOX_COUNT_LAYOUT)this.showElementIf(this.connectButton,!this.useDisconnectLink||!a);if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT){this.manageBoxCountButtonAnimation(a);}else if(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){this.manageButtonCountButtonAnimation(a);}else this.manageStandardButtonAnimation(a);if(!this.loggedInUserPhotoDiv)return;if(a){this.slideUserPhotoIn(this.loggedInUserPhotoDiv);}else this.slideUserPhotoOut(this.loggedInUserPhotoDiv);},manageStandardButtonAnimation:function(a){if(this.alreadyConnected){this.hideButton(true);}else this.hideButton(false);},setButtonState:function(a){if(a){CSS.removeClass(this.connectButton,'like_button_no_like');CSS.addClass(this.connectButton,'like_button_like');}else{CSS.addClass(this.connectButton,'like_button_no_like');CSS.removeClass(this.connectButton,'like_button_like');}},hideButton:function(a){if(this.layout!=='standard')return;if(this.oAnimateBlind)this.oAnimateBlind.stop();this.oAnimateBlind=animation(this.connectButtonSlider).duration(150);var c=1,b=intl_locale_is_rtl(),d=b?'marginRight':'marginLeft',e=b?'marginLeft':'marginRight';if(a){this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonContainer,d,'2px');CSS.setStyle(this.connectButtonContainer,'visibility','hidden');CSS.addClass(this.confirmationCell,'connect_confirmation_cell_like');CSS.removeClass(this.confirmationCell,'connect_confirmation_cell_no_like');this.oAnimateBlind=null;}.bind(this));}else{CSS.setStyle(this.connectButtonContainer,d,'0px');c=Vector2.getElementDimensions(this.connectButton).x;this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonSlider,'overflow','visible');CSS.setStyle(this.connectButtonSlider,'width','auto');CSS.removeClass(this.confirmationCell,'connect_confirmation_cell_like');CSS.addClass(this.confirmationCell,'connect_confirmation_cell_no_like');CSS.setStyle(this.connectButtonContainer,'visibility','visible');this.oAnimateBlind=null;}.bind(this));}this.oAnimateBlind.to('width',c).blind().go();},showElementIf:function(a,b){if(!a)return;if(b){CSS.show(a);}else CSS.hide(a);},slideUserPhotoIn:function(b){if(!CSS.hasClass(b,'connect_widget_user_not_connected'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.removeClass(b,'connect_widget_user_not_connected');animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();},slideUserPhotoOut:function(a){if(CSS.hasClass(a,'connect_widget_user_not_connected'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.addClass(a,'connect_widget_user_not_connected');CSS.setStyle(a,'width',null);}).go();},_clickLocked:false,connectToNodeOnClick:function(event){Event.kill(event);if(!this._clickLocked){this._clickLocked=true;setTimeout(function(){this._clickLocked=false;}.bind(this),1000);if(this.viewerID==0||this.userOptedOut){this.presentOptIn();}else this.connectToNode(!this.alreadyConnected);}},connectToNode:function(d){if(!d){if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT&&!this.usingConnectLibrary){CSS.addClass(this.userActionTextSpan,'hidden_elem');CSS.removeClass(this.summaryTextSpan,'hidden_elem');CSS.setStyle(this.summaryTextSpan,'opacity',1);}if(this.shareCommentSpans)for(var b=0;b<this.shareCommentSpans.length;b++)CSS.addClass(this.shareCommentSpans[b],'hidden_elem');if(this.commentWidgetOpen){this.closeCommentWidget();}else if(this.inlineCommentFlyoutOpen)this.closeInlineComment();}this.updateWidget({nowConnected:!this.alreadyConnected,isAdmin:this.viewerIsAdmin},false);var a={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,page_id:this.pageId,layout:this.layout,show_captcha:this.showCaptcha,connect_text:this.connectText,ref:this.ref,now_connected:d,post_form_id:$('post_form_id').value};Bootloader.loadComponents(['async','async-postlude','vector'],function(){if(this.mouseExtent){sizeB=Vector2.getElementDimensions(this.connectButton);extW=MouseExtentWindow.getInstance().getMouseExtent();extB=this.mouseExtent.getMouseExtent();a.me=[sizeB.x,sizeB.y,extW.x,extW.y,extB.x,extB.y].join('|');a.dly=Math.round((new Date().getTime()-this.loadTime)\/1000);}new AsyncRequest().setURI(this.getAjaxEndpoint()).setHandler(this.syncWidgetWithServer.bind(this)).setData(a).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();}.bind(this));if(d){if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT)this.requiresMouseLeaveEvent=true;if(this.layout===ExternalNodeConnectWidget.STANDARD_LAYOUT&&!this.usingConnectLibrary){CSS.setStyle(this.userActionTextSpan,'opacity',1);CSS.removeClass(this.userActionTextSpan,'hidden_elem');CSS.addClass(this.summaryTextSpan,'hidden_elem');Event.listen(this.widget,'mouseleave',this.transitionBetweenMessages.bind(this));}if(this.shareCommentSpans){for(var c=0;c<this.shareCommentSpans;c++)CSS.removeClass(this.shareCommentSpans[c],'hidden_elem');}else if(this.supportCommenting)this.presentCommentingOption();}},transitionBetweenMessages:function(event){if(!this.alreadyConnected||CSS.hasClass(this.userActionTextSpan,'hidden_elem'))return;animation(this.userActionTextSpan).to('opacity',0).duration(500).ondone(function(){CSS.addClass(this.userActionTextSpan,'hidden_elem');CSS.setStyle(this.summaryTextSpan,'opacity',0);CSS.removeClass(this.summaryTextSpan,'hidden_elem');animation(this.summaryTextSpan).to('opacity',1).duration(500).go();}.bind(this)).go();},presentCommentingOption:function(){if(this.usingConnectLibrary){ExternalNodeConnectWidget.self=this;var a={type:'presentEdgeCommentDialog',masterFrameName:window.name,version:2};if(this.layout==ExternalNodeConnectWidget.BOX_COUNT_LAYOUT){a.preComputedWidthOffset=this.computeButtonDimensionsWithPadding().width;if(!intl_locale_is_rtl())a.preComputedWidthOffset+=8;}if(this.socialBar)a.left=parseInt(CSS.getStyle(document.getElementById('profile'),'width'),10)+1;UnverifiedXD.send(a);this.commentWidgetOpen=true;this.commentWidgetVisible=true;}else if(this.usingInlineCommenting)if(!this.inlineCommentListenersInitialized){this.initializeInlineCommentListeners();this.openInlineCommentFlyout();this.positionInlineCommentFlyout();this.inlineCommentListenersInitialized=true;}else this.openInlineCommentFlyout();},initializeInlineCommentListeners:function(){this.inlineCommentFlyout=DOM.find(this.widget,'.connect_widget_comment_box');this.inlineCommentInput=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_textinput');this.inlineCommentButton=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_button');this.inlineCommentClose=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_close_button');this.commentButtonIsActive=false;Event.listen(this.inlineCommentInput,'keyup',this.conditionallyActivateButton.bind(this));Event.listen(this.inlineCommentInput,'focus',this.exposeCommentButton.bind(this));Event.listen(this.inlineCommentButton,'click',this.updateConnectionWithComment.bind(this));Event.listen(this.widget,'mouseout',this.hideInlineComment.bind(this));Event.listen(this.widget,'mouseover',this.showInlineComment.bind(this));if(this.inlineCommentClose)Event.listen(this.inlineCommentClose,'click',function(event){for(var a=0;a<this.shareCommentSpans.length;a++)CSS.removeClass(this.shareCommentSpans[a],'hidden_elem');this.closeInlineComment();}.bind(this));},exposeCommentButton:function(event){if(!CSS.hasClass(this.inlineCommentButton,'hidden_elem'))return;CSS.removeClass(this.inlineCommentButton,'hidden_elem');CSS.setStyle(this.inlineCommentInput,'width',this.textInputWidthWithButton+'px');},openInlineCommentFlyout:function(){CSS.show(this.inlineCommentFlyout);this.inlineCommentFlyoutOpen=true;this.inlineCommentFlyoutVisible=true;},manageBoxCountButtonAnimation:function(a){if(a){this.animateBoxCountButtonDisappearance();}else this.animateBoxCountButtonReappearance();},animateBoxCountButtonDisappearance:function(){CSS.addClass(this.connectButton,'hidden_elem');CSS.setStyle(this.numberCloudExtension,'opacity',0);CSS.removeClass(this.numberCloudExtension,'hidden_elem');CSS.addClass(this.numberCloudNub,'hidden_elem');CSS.addClass(this.numberCloudUnlikeSpan,'hidden_elem');CSS.removeClass(this.numberCloudReminderSpan,'hidden_elem');animation(this.numberCloud).to('height',this.expandedNumberCloudHeight).duration(100).ondone(function(){animation(this.numberCloudExtension).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();},animateBoxCountButtonReappearance:function(){CSS.addClass(this.numberCloudExtension,'hidden_elem');animation(this.numberCloud).to('height',this.collapsedNumberCloudHeight).duration(75).ondone(function(){CSS.setStyle(this.connectButton,'opacity',0);CSS.removeClass(this.connectButton,'hidden_elem');animation(this.connectButton).from('opacity',0).to('opacity',1).duration(75).ondone(function(){CSS.setStyle(this.numberCloudNub,'opacity',0);CSS.removeClass(this.numberCloudNub,'hidden_elem');animation(this.numberCloudNub).from('opacity',0).to('opacity',1).duration(50).go();}.bind(this)).go();}.bind(this)).go();},manageButtonCountButtonAnimation:function(a){if(a){this.animateButtonCountButtonDisappearance();}else this.animateButtonCountButtonReappearance();CSS.removeClass(this.thumbsUpIcon,'hidden_elem');CSS.addClass(this.undoRegion,'hidden_elem');},animateButtonCountButtonDisappearance:function(){animation(this.connectButton).from('opacity',1).to('opacity',0).from('width',this.originalButtonWidth).to('width','0px').ondone(function(){CSS.addClass(this.connectButton,'hidden_elem');}.bind(this)).duration(100).go();animation(this.numberExcluding).from('opacity',1).to('opacity',0).duration(100).ondone(function(){CSS.addClass(this.numberExcluding,'hidden_elem');CSS.setStyle(this.summaryIncluding,'opacity',0);CSS.removeClass(this.summaryIncluding,'hidden_elem');animation(this.summaryIncluding).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();},computeButtonDimensions:function(){var c=CSS.hasClass(this.connectButton,'hidden_elem');if(c){CSS.addClass(this.connectButton,'connect_widget_offscreen');CSS.removeClass(this.connectButton,'hidden_elem');}var a=Vector2.getElementDimensions(this.connectButton);var d=a.x;var b=a.y;var f=parseInt(CSS.getStyle(this.connectButton,'paddingLeft'),10);var g=parseInt(CSS.getStyle(this.connectButton,'paddingRight'),10);var h=parseInt(CSS.getStyle(this.connectButton,'paddingTop'),10);var e=parseInt(CSS.getStyle(this.connectButton,'paddingBottom'),10);if(c){CSS.addClass(this.connectButton,'hidden_elem');CSS.removeClass(this.connectButton,'connect_widget_offscreen');}return {width:d-f-g-2,height:b};},computeButtonDimensionsWithPadding:function(){var c=CSS.hasClass(this.connectButton,'hidden_elem');if(c){CSS.addClass(this.connectButton,'connect_widget_offscreen');CSS.removeClass(this.connectButton,'hidden_elem');}var a=Vector2.getElementDimensions(this.connectButton);var d=a.x;var b=a.y;if(c){CSS.addClass(this.connectButton,'hidden_elem');CSS.removeClass(this.connectButton,'connect_widget_offscreen');}return {width:d,height:b};},animateButtonCountButtonReappearance:function(){animation(this.connectButton).from('width','0px').to('width',this.originalButtonWidth).from('opacity',0).to('opacity',1).duration(100).go();CSS.setStyle(this.summaryIncluding,'opacity',1);animation(this.summaryIncluding).from('opacity',1).to('opacity',0).duration(100).ondone(function(){CSS.addClass(this.summaryIncluding,'hidden_elem');CSS.setStyle(this.numberExcluding,'opacity',0);CSS.removeClass(this.numberExcluding,'hidden_elem');animation(this.numberExcluding).from('opacity',0).to('opacity',1).duration(100).go();}.bind(this)).go();},injectCommentWidgetMarkup:function(a){this.commentDocument=a;this.commentDocument.body.innerHTML=this.commentWidgetMarkup;this.transferCSSStyles();if(this.newProfilePic){var c=DOM.find(this.commentDocument,'img.connect_comment_widget_user_pic');c.src=this.newProfilePic;delete this.newProfilePic;}this.commentNub=DOM.find(this.commentDocument,(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT?'div.side_nub':'div.nub'));this.placeholderInputRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_placeholder_input_region');this.placeholderInput=DOM.find(this.placeholderInputRegion,'input.connect_comment_widget_placeholder_input');this.fullInputRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_full_input_region');this.fullInputTextarea=DOM.find(this.fullInputRegion,'textarea.connect_comment_widget_full_input_textarea');this.widgetButtonRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_button_region');this.postToFacebookButton=DOM.find(this.widgetButtonRegion,'.connect_comment_widget_post_button input');this.cancelButton=DOM.find(this.widgetButtonRegion,'.connect_comment_widget_cancel_button input');this.inlineUnlikeLink=DOM.find(this.commentDocument,'a.connect_comment_widget_unlike_link');this.defaultInputText=this.placeholderInput.value;this.placeholderInput.onfocus=this.transitionToFullInputMode.bind(this);this.fullInputTextarea.onfocus=this.removePlaceholderText.bind(this);this.fullInputTextarea.onblur=this.restorePlaceholderText.bind(this);this.postToFacebookButton.onclick=this.updateUserComment.bind(this);this.cancelButton.onclick=this.dismissCommentWidget.bind(this);this.inlineUnlikeLink.onclick=this.connectToNodeOnClick.bind(this);var b=this.getCommentActivatingComponent();b.onmouseout=this.hideCommentWidget.bind(this);b.onmouseover=this.showCommentWidget.bind(this);this.commentDocument.body.onmouseout=this.hideCommentWidget.bind(this);this.commentDocument.body.onmouseover=this.showCommentWidget.bind(this);this.inGracePeriod=false;},getCommentActivatingComponent:function(){if(this.layout===ExternalNodeConnectWidget.BOX_COUNT_LAYOUT){return this.numberCloud;}else if(this.layout===ExternalNodeConnectWidget.BUTTON_COUNT_LAYOUT){return this.widget;}else return this.confirmationCell;},showCommentWidget:function(event){this.inGracePeriod=true;this.killCloseThread();if(this.commentWidgetOpen&&!this.commentWidgetVisible){this.commentWidgetVisible=true;CSS.show(this.commentDocument.body);UnverifiedXD.send({type:'showEdgeCommentDialog'});}return false;},hideCommentWidget:function(event){this.inGracePeriod=false;if(this.commentWidgetOpen&&this.commentWidgetVisible){var a=function(){if(!this.inGracePeriod&&!this.commentWidgetIsExpanded){this.commentWidgetVisible=false;if(!this.socialBar)CSS.hide(this.commentDocument.body);UnverifiedXD.send({type:'hideEdgeCommentDialog'});}this.inGracePeriod=false;this.killCloseThread();}.bind(this);this.closeThreadID=setTimeout(a,100);}return false;},killCloseThread:function(){if(this.closeThreadID){clearTimeout(this.closeThreadID);delete this.closeThreadID;}},transferCSSStyles:function(){var d=DOM.scry(window.document,'link');var e=DOM.scry(window.document,'style');var c=DOM.find(window.document,'html');var g=DOM.find(this.commentDocument,'html');var f=DOM.find(this.commentDocument,'head');for(var a=0;a<d.length;a++)if(d[a].rel=='stylesheet'){var b=this.commentDocument.createElement('link');b.rel=d[a].rel;b.href=d[a].href;b.type=d[a].type;f.appendChild(b);}if(window.ResourceBundler)ResourceBundler.applyCSSToDocument(this.commentDocument);g.id=c.id;g.className=c.className;this.commentDocument.body.className=window.document.body.className;},transitionToFullInputMode:function(event){this.commentWidgetIsExpanded=true;CSS.hide(this.placeholderInputRegion);CSS.show(this.fullInputRegion);CSS.show(this.widgetButtonRegion);this.fullInputTextarea.focus();return false;},removePlaceholderText:function(event){if(CSS.hasClass(this.fullInputTextarea,'connect_comment_widget_disabled')){CSS.removeClass(this.fullInputTextarea,'connect_comment_widget_disabled');this.fullInputTextarea.value='';}return false;},restorePlaceholderText:function(event){if(this.fullInputTextarea.value.trim()==''){this.fullInputTextarea.value=this.defaultInputText;CSS.addClass(this.fullInputTextarea,'connect_comment_widget_disabled');}return false;},updateUserComment:function(event){var a=this.fullInputTextarea.value.trim();if(a!=''&&a!=this.defaultInputText)this.postUserComment(a);return false;},dismissCommentWidget:function(event){this.closeCommentWidget();return false;},getAjaxEndpoint:function(){return '\/ajax\/connect\/external_node_connect.php';},getCommentAjaxEndpoint:function(){return '\/ajax\/connect\/external_edge_comment.php';},updateLoggedInUser:function(b,a){ExternalNodeConnectWidget.updateLoggedInUser(b,a);}});\nfunction fbpage_set_fan_status(c,f,a,h,g,d,e){g=g?g:function(j){_fbpage_show_change_status_feedback(c,j.getPayload());};var b={fbpage_id:f,add:a,reload:h};if(e!=null)copy_properties(b,e);var i=new AsyncRequest().setURI('\/ajax\/pages\/fan_status.php').setData(b).setNectarModuleDataSafe(c).setHandler(g);if(d)i.setErrorHandler(d);i.send();return false;}function fbpage_set_favorite_status(d,e,a){var f=function(){_fbpage_show_change_status_feedback(d,this.getUserData());};var c={fbpage_id:e,add:a};var b=new AsyncRequest().setMethod('POST').setURI('\/ajax\/pages\/favorite_status.php').setData(c);new Dialog().setAsync(b).setCloseHandler(f).show();return false;}function _fbpage_show_change_status_feedback(b,a){if(!a||!b)return;if(a.reload){fbpage_reload_on_fan_status_changed(a.preserve_tab);}else fbpage_redraw_on_fan_status_changed(b,a.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a)if(!b.getQueryData().v&&window.profile_tab_controller)b.addQueryData({v:window.profile_tab_controller.currentView});goURI(b,true);}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;var d=document.createElement('span');d.innerHTML=b;CSS.setClass(d,'fan_status_inactive');a.parentNode.replaceChild(d,a);var c=function(){if(data.can_repeat_action)d.parentNode.replaceChild(a,d);};animation(d).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(c).go();}\nfunction ConnectWidget(h,f,a,e,b){copy_properties(this,{channel_url:b,like_mode:e,profile_id:f,viewer_id:h,status:null,popup:null,busy:false,new_fan:null,user_profile:null});this.fan_hidden=[];this.fan_shown=[];var c=DOM.scry(document,'div.connections');if(c.length>0){c=c[0];this.user_profile=DOM.find(c,'div.user_profile');this.new_fan=DOM.find(c,'div.grid_item_plus');this.fan_shown.push(this.new_fan);this.fan_shown.push(DOM.find(c,'span.total_plus'));var g=DOM.scry(c,'span.total');var d=DOM.scry(c,'div.grid_item');if(d.length>1)this.fan_hidden.push(d[1]);this.fan_hidden.push(g[g.length-1]);}if(!this.like_mode){this.button=$(a);this.popup_uri=new URI('\/login.php');this.popup_uri.addQueryData({connect_id:this.profile_id,popup:true});Event.listen(this.button,'click',this.connectClickHandler.bind(this));}else Arbiter.subscribe('platform\/like\/connection',this.updateWidgetFromLike.bind(this));ConnectWidget.instances[a]=this;if(this.channel_url)XD.init({channelUrl:this.channel_url});}ConnectWidget.instances={};ConnectWidget.is_connect=true;ConnectWidget.prototype.setLoggedIn=function(a){this.viewer_id=a;return this;};ConnectWidget.prototype.connectClickHandler=function(a){a.kill();if(this.viewer_id!=0){this.connect();}else this.popUpLogin();};ConnectWidget.prototype.connect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,true,false,this.connectDoneHandler.bind(this),this.connectErrorHandler.bind(this),this.getAsyncData());}};ConnectWidget.prototype.disconnect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,false,false,this.connectUndoneHandler.bind(this),function(){},this.getAsyncData());}};ConnectWidget.prototype.getAsyncData=function(){var a={source:'connect',is_connect:ConnectWidget.is_connect};if(ge('post_form_id'))a.post_form_id=$('post_form_id').value;if(env_get('fb_dtsg'))a.fb_dtsg=env_get('fb_dtsg');return a;};ConnectWidget.prototype.popUpLogin=function(){window.open(this.popup_uri.toString(),'_blank','toolbar=0,status=0,width=626,height=400');};ConnectWidget.prototype.updateWidgetFromLike=function(b,e){if(!e.userProfile)return;if(this.user_profile){var c=DOM.find(this.user_profile,'img');var a=DOM.find(this.user_profile,'a');var d=DOM.find(this.user_profile,'div.name');c.src=e.userProfile.pic_square;a.href=e.userProfile.profile_url;DOM.setContent(d,e.userProfile.name);}if(e.nowConnected){if(this.channel_url)XD.send({type:'likeboxLiked'});this.showNewFan();}else this.hideNewFan();};ConnectWidget.prototype.connectErrorHandler=function(b){if(b.error==1357001){this.viewer_id=0;this.popUpLogin();}else if(b.error==1357013){CSS.hide(this.button);var a=$N('a',{href:DOM.find(document,'div.name_block a').href,target:'_blank'},_tx(\"Verification is needed to connect.\"));this.status=$N('span',{className:'connect_span'},a);DOM.insertAfter(this.button,this.status);}else{CSS.hide(this.button);if(b.error==1431001){this.status=$N('span',{className:'connect_span'},_tx(\"You like this.\"));}else this.status=$N('span',{className:'connect_span'},b.getErrorSummary()+': '+b.getErrorDescription());animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);}this.busy=false;};ConnectWidget.prototype.connectDoneHandler=function(c){var b=c.getPayload();if(!b||!b.feedback)return;this.status=$N('span',{className:'connect_span'},HTML(b.feedback));var d=$N('a',{className:'undo'},_tx(\"Undo\"));Event.listen(d,'click',function(e){e.kill();this.disconnect();}.bind(this));DOM.appendContent(this.status,d);animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);CSS.hide(this.button);if(this.new_fan!=null&&b.connect_fan_div){var a=$N('div',{},HTML(b.connect_fan_div));DOM.setContent(this.new_fan,DOM.find(a,'a'));}this.showNewFan();this.busy=false;};ConnectWidget.prototype.showNewFan=function(){this.fan_shown.forEach(function(b){if(!CSS.hasClass(b,'hidden_elem'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.show(b);animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();});this.fan_hidden.forEach(function(a){CSS.hide(a);});};ConnectWidget.prototype.connectUndoneHandler=function(b){var a=b.getPayload();DOM.remove(this.status);animation(this.button).from('opacity',0).to('opacity',1).go();CSS.show(this.button);this.hideNewFan();this.busy=false;};ConnectWidget.prototype.hideNewFan=function(){this.fan_shown.forEach(function(a){if(CSS.hasClass(a,'hidden_elem'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.setStyle(a,'width',null);CSS.hide(a);this.fan_hidden.forEach(function(b){CSS.show(b);});}.bind(this)).go();}.bind(this));};ConnectWidget.loadStream=function(b,a){new AsyncRequest().setMethod('GET').setURI('\/ajax\/connect\/connect_widget.php').setData({id:b}).setReadOnly(true).setErrorHandler(bagofholding).setHandler(function(c){payload=c.getPayload();DOM.setContent($(a),HTML(payload.stream_markup));}.bind(this)).send();};ConnectWidget.loggedIn=function(c,a){if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(a));}else DOM.appendContent(DOM.find(document,'body'),HTML(a));for(var b in ConnectWidget.instances){ConnectWidget.instances[b].setLoggedIn(c);ConnectWidget.instances[b].connect();}};ConnectWidget.setIsConnect=function(a){ConnectWidget.is_connect=a;};ConnectWidget.popUpConnect=function(c){var b={id:c,captcha:true,post_form_id:$('post_form_id').value};var d=URI('\/plugins\/likebox.php').addQueryData(b);var a=window.open(d,'_blank','toolbar=0,status=0,width=640,height=480');};\nvar ExternalPageLikeWidget=function(a){a.edgeType='like';this.parent.construct(this,a);this.unactionLink=DOM.scry(this.widget,'span.unlike_link')[0];if(this.unactionLink)Event.listen(this.unactionLink,'click',this.connectToNodeOnClick.bind(this));};ExternalPageLikeWidget.extend('ExternalNodeConnectWidget');copy_properties(ExternalPageLikeWidget.prototype,{getSyncEndpointName:function(){return 'platform\/like\/sync';},getConnectionEndpointName:function(){return 'platform\/like\/connection';},getPluginName:function(){return 'like';}});\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/2dm7thlclh7ow4cc.pkg.js\"]); }")